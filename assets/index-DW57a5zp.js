import*as o from"three";import{MindARThree as w}from"mindar-image-three";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function m(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(e){if(e.ep)return;e.ep=!0;const n=m(e);fetch(e.href,n)}})();let c=null,u=!1,t=null;const x=document.getElementById("loading-screen"),l=document.getElementById("welcome-screen"),f=document.getElementById("ar-container"),T=document.getElementById("start-button"),C=document.getElementById("back-button"),r=document.querySelector(".ar-title");window.addEventListener("load",()=>{setTimeout(()=>{x.classList.add("hidden")},1e3)});T.addEventListener("click",async()=>{try{l.classList.add("fade-out"),r.textContent="â³ Äang khá»Ÿi Ä‘á»™ng Camera...",setTimeout(async()=>{l.style.display="none",f.style.display="block",await R()},500)}catch(i){console.error("Error starting AR:",i),alert("KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng AR. Vui lÃ²ng Ä‘áº£m báº£o báº¡n Ä‘Ã£ cáº¥p quyá»n camera vÃ  sá»­ dá»¥ng HTTPS."),f.style.display="none",l.style.display="flex",l.classList.remove("fade-out")}});C.addEventListener("click",()=>{F(),f.style.display="none",l.style.display="flex",l.classList.remove("fade-out")});async function R(){try{r.textContent="â³ Äang táº£i dá»¯ liá»‡u AR...",c=new w({container:document.querySelector("#ar-scene"),imageTargetSrc:"./targets.mind"});const{renderer:i,scene:a,camera:m}=c,d=new o.AmbientLight(16777215,.8);a.add(d);const e=new o.DirectionalLight(16777215,.6);e.position.set(1,1,1),a.add(e);const n=c.addAnchor(0);t=document.createElement("video"),t.src="./video.mp4",t.loop=!0,t.muted=!0,t.playsInline=!0,t.setAttribute("playsinline","");const s=new o.VideoTexture(t);s.minFilter=o.LinearFilter,s.magFilter=o.LinearFilter,s.format=o.RGBAFormat;const h=16/9,v=new o.PlaneGeometry(1,1/h),L=new o.MeshBasicMaterial({map:s,side:o.DoubleSide}),y=new o.Mesh(v,L);y.position.z=.01,n.group.add(y);const A=new o.RingGeometry(.52,.56,64),b=new o.MeshStandardMaterial({color:16766720,emissive:16766720,emissiveIntensity:.3,metalness:.8,roughness:.2}),g=new o.Mesh(A,b);g.position.z=.02,n.group.add(g),n.onTargetFound=()=>{console.log("Target found! Playing video..."),r.textContent="ğŸ‰ ÄÃ£ tÃ¬m tháº¥y Marker!",r.style.color="#4ECDC4",t&&t.play().catch(E=>{console.log("Autoplay prevented:",E),r.textContent="ğŸ‘† Cháº¡m mÃ n hÃ¬nh Ä‘á»ƒ phÃ¡t video";const p=()=>{t.play(),t.muted=!1,document.body.removeEventListener("click",p),r.textContent="ğŸ‰ Äang phÃ¡t video!"};document.body.addEventListener("click",p)})},n.onTargetLost=()=>{console.log("Target lost"),r.textContent="ğŸ” HÃ£y soi vÃ o áº£nh Tracker...",r.style.color="white",t&&t.pause()},r.textContent="â³ Äang báº­t Camera...",await c.start(),u=!0,r.textContent="âœ… Sáºµn sÃ ng! QuÃ©t áº£nh Ä‘i báº¡n Æ¡i",i.setAnimationLoop(()=>{i.render(a,m)}),console.log("âœ… AR initialized successfully!")}catch(i){console.error("AR Initialization Error:",i),r.textContent="âŒ Lá»—i: "+(i.message||"KhÃ´ng thá»ƒ táº£i AR"),alert("Lá»—i khá»Ÿi Ä‘á»™ng AR: "+i)}}function F(){c&&u&&(c.stop(),c.renderer.setAnimationLoop(null),u=!1),t&&(t.pause(),t.currentTime=0)}document.addEventListener("visibilitychange",()=>{document.hidden&&u&&t&&t.pause()});
