import*as o from"three";import{MindARThree as b}from"mindar-image-three";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function u(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(t){if(t.ep)return;t.ep=!0;const n=u(t);fetch(t.href,n)}})();let s=null,g=!1,e=null;const C=document.getElementById("loading-screen"),d=document.getElementById("welcome-screen"),y=document.getElementById("ar-container"),M=document.getElementById("start-button"),T=document.getElementById("back-button"),r=document.querySelector(".ar-title");window.addEventListener("load",()=>{setTimeout(()=>{C.classList.add("hidden")},1e3)});M.addEventListener("click",async()=>{try{d.classList.add("fade-out"),r.textContent="â³ Äang khá»Ÿi Ä‘á»™ng...",setTimeout(async()=>{d.style.display="none",y.style.display="block",await B()},500)}catch(i){console.error("Error starting AR:",i),alert("KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng AR. Vui lÃ²ng refresh vÃ  thá»­ láº¡i."),y.style.display="none",d.style.display="flex",d.classList.remove("fade-out")}});T.addEventListener("click",()=>{F(),y.style.display="none",d.style.display="flex",d.classList.remove("fade-out"),window.location.reload()});async function B(){try{r.textContent="â³ Äang táº£i dá»¯ liá»‡u AR (0%)...",console.log("Resolving asset paths...");const i=new URL("/ar-card/assets/targets-BI1wfD3M.mind",import.meta.url).href,a=new URL("/ar-card/assets/video-DnOXofXB.mp4",import.meta.url).href;console.log("Target URL:",i),console.log("Video URL:",a),s=new b({container:document.querySelector("#ar-scene"),imageTargetSrc:i,uiLoading:"yes",uiScanning:"no",filterMinCF:.1,filterBeta:10});const{renderer:u,scene:l,camera:t}=s,n=new o.AmbientLight(16777215,.8);l.add(n);const c=new o.DirectionalLight(16777215,.6);c.position.set(1,1,1),l.add(c);const m=s.addAnchor(0);e=document.createElement("video"),e.src=a,e.loop=!0,e.muted=!0,e.playsInline=!0,e.setAttribute("playsinline",""),e.crossOrigin="anonymous",e.load();const f=new o.VideoTexture(e);f.minFilter=o.LinearFilter,f.magFilter=o.LinearFilter,f.format=o.RGBAFormat;const v=16/9,w=new o.PlaneGeometry(1,1/v),R=new o.MeshBasicMaterial({map:f,side:o.DoubleSide}),p=new o.Mesh(w,R);p.position.z=.01,m.group.add(p);const A=new o.RingGeometry(.52,.56,64),E=new o.MeshStandardMaterial({color:16766720,emissive:16766720,emissiveIntensity:.3,metalness:.8,roughness:.2}),h=new o.Mesh(A,E);h.position.z=.02,m.group.add(h),m.onTargetFound=()=>{if(console.log("ğŸ¯ Target found!"),r.textContent="ğŸ‰ ÄÃ£ tÃ¬m tháº¥y Marker!",r.style.color="#4ECDC4",e){const L=e.play();L!==void 0&&L.catch(x=>{console.log("Autoplay prevented:",x),r.textContent="ğŸ‘† Cháº¡m vÃ o mÃ n hÃ¬nh Ä‘á»ƒ xem video"})}},m.onTargetLost=()=>{console.log("âŒ Target lost"),r.textContent="ğŸ” Äang tÃ¬m hÃ¬nh marker...",r.style.color="white",e&&e.pause()},document.body.addEventListener("click",()=>{e&&!e.playing&&(e.play(),e.muted=!1)},{once:!0}),r.textContent="â³ Äang khá»Ÿi Ä‘á»™ng Engine...",console.log("Starting MindAR..."),await s.start(),g=!0,r.textContent="âœ… ÄÃ£ sáºµn sÃ ng! HÃ£y quÃ©t áº£nh.",console.log("MindAR started successfully!"),u.setAnimationLoop(()=>{u.render(l,t)})}catch(i){console.error("ğŸ”¥ AR CRITICAL ERROR:",i),r.textContent="âŒ Lá»—i: "+i.message,alert("KhÃ´ng thá»ƒ táº£i file targets.mind hoáº·c video. Kiá»ƒm tra máº¡ng cá»§a báº¡n!")}}function F(){s&&g&&(s.stop(),s.renderer.setAnimationLoop(null),g=!1),e&&(e.pause(),e.src="",e.load())}document.addEventListener("visibilitychange",()=>{document.hidden&&g&&e&&e.pause()});
