import*as n from"three";import{MindARThree as b}from"mindar-image-three";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function u(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=u(e);fetch(e.href,o)}})();let a=null,d=!1,t=null;const E=document.getElementById("loading-screen"),l=document.getElementById("welcome-screen"),m=document.getElementById("ar-container"),R=document.getElementById("start-button"),F=document.getElementById("back-button"),p=document.querySelector(".ar-title");window.addEventListener("load",()=>{setTimeout(()=>{E.classList.add("hidden")},1e3)});R.addEventListener("click",async()=>{try{l.classList.add("fade-out"),setTimeout(async()=>{l.style.display="none",m.style.display="block",await x()},500)}catch(r){console.error("Error starting AR:",r),alert("KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng AR. Vui lÃ²ng Ä‘áº£m báº£o báº¡n Ä‘Ã£ cáº¥p quyá»n camera vÃ  sá»­ dá»¥ng HTTPS."),m.style.display="none",l.style.display="flex",l.classList.remove("fade-out")}});F.addEventListener("click",()=>{M(),m.style.display="none",l.style.display="flex",l.classList.remove("fade-out")});async function x(){try{a=new b({container:document.querySelector("#ar-scene"),imageTargetSrc:"./targets.mind"});const{renderer:r,scene:s,camera:u}=a,c=new n.AmbientLight(16777215,.8);s.add(c);const e=new n.DirectionalLight(16777215,.6);e.position.set(1,1,1),s.add(e);const o=a.addAnchor(0);t=document.createElement("video"),t.src="./video.mp4",t.loop=!0,t.muted=!0,t.playsInline=!0,t.setAttribute("playsinline","");const i=new n.VideoTexture(t);i.minFilter=n.LinearFilter,i.magFilter=n.LinearFilter,i.format=n.RGBAFormat;const y=16/9,h=new n.PlaneGeometry(1,1/y),v=new n.MeshBasicMaterial({map:i,side:n.DoubleSide}),f=new n.Mesh(h,v);f.position.z=.01,o.group.add(f);const L=new n.RingGeometry(.52,.56,64),w=new n.MeshStandardMaterial({color:16766720,emissive:16766720,emissiveIntensity:.3,metalness:.8,roughness:.2}),g=new n.Mesh(L,w);g.position.z=.02,o.group.add(g),o.onTargetFound=()=>{console.log("Target found! Playing video..."),p.textContent="ğŸ‰ Äang phÃ¡t video!",t&&t.play().catch(A=>{console.log("Autoplay prevented, unmuting might be required:",A),t.muted=!1,t.play().catch(T=>{console.error("Failed to play video:",T)})})},o.onTargetLost=()=>{console.log("Target lost, pausing video"),p.textContent="TÃ¬m kiáº¿m marker...",t&&t.pause()},await a.start(),d=!0,r.setAnimationLoop(()=>{r.render(s,u)}),console.log("âœ… AR initialized successfully!"),console.log("ğŸ“¹ Video ready to play when marker is detected")}catch(r){throw console.error("AR Initialization Error:",r),r}}function M(){a&&d&&(a.stop(),a.renderer.setAnimationLoop(null),d=!1),t&&(t.pause(),t.currentTime=0)}document.addEventListener("visibilitychange",()=>{document.hidden&&d&&t&&t.pause()});console.log("ğŸŠ AR Video Player initialized!");console.log("ğŸ“ Next steps:");console.log("   1. Generate targets.mind file from tracker.jpg");console.log("   2. Place targets.mind in project root");console.log("   3. Start AR and point camera at tracker image");console.log("   4. Video will play automatically when tracker is detected");
