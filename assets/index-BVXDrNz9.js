import*as n from"three";import{MindARThree as h}from"mindar-image-three";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const r of e.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();let d=null,u=!1;const w=document.getElementById("loading-screen"),m=document.getElementById("welcome-screen"),y=document.getElementById("ar-container"),A=document.getElementById("start-button"),b=document.getElementById("back-button"),p=document.querySelector(".ar-title");window.addEventListener("load",()=>{setTimeout(()=>{w.classList.add("hidden")},1e3)});A.addEventListener("click",async()=>{try{m.classList.add("fade-out"),setTimeout(async()=>{m.style.display="none",y.style.display="block",await L()},500)}catch(o){console.error("Error starting AR:",o),alert("KhÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng AR. Vui lÃ²ng Ä‘áº£m báº£o báº¡n Ä‘Ã£ cáº¥p quyá»n camera vÃ  sá»­ dá»¥ng HTTPS."),y.style.display="none",m.style.display="flex",m.classList.remove("fade-out")}});b.addEventListener("click",()=>{g(),y.style.display="none",m.style.display="flex",m.classList.remove("fade-out")});async function L(){try{d=new h({container:document.querySelector("#ar-scene"),imageTargetSrc:"./targets.mind"});const{renderer:o,scene:i,camera:s}=d,a=new n.AmbientLight(16777215,.6);i.add(a);const t=new n.DirectionalLight(16777215,.8);t.position.set(1,1,1),i.add(t);const e=d.addAnchor(0),r=new n.Group;await M(r),v(r),e.group.add(r),e.onTargetFound=()=>{console.log("Target found!"),p.textContent="ğŸ‰ ÄÃ£ tÃ¬m tháº¥y thiá»‡p!"},e.onTargetLost=()=>{console.log("Target lost"),p.textContent="TÃ¬m kiáº¿m marker..."},await d.start(),u=!0,o.setAnimationLoop(()=>{o.render(i,s)})}catch(o){throw console.error("AR Initialization Error:",o),o}}async function M(o){const i=new n.PlaneGeometry(1,1.4),s=new n.MeshStandardMaterial({color:16777215,emissive:16739179,emissiveIntensity:.2,side:n.DoubleSide}),a=new n.Mesh(i,s);o.add(a);const t=new n.RingGeometry(.52,.56,64),e=new n.MeshStandardMaterial({color:16766720,emissive:16766720,emissiveIntensity:.5,metalness:.8,roughness:.2}),r=new n.Mesh(t,e);r.position.z=.01,o.add(r),E(o);let l=0;const c=()=>{l+=.01,o.rotation.y=Math.sin(l)*.1,o.position.y=Math.sin(l*2)*.02};renderer.setAnimationLoop(()=>{c()})}function v(o){const i=new n.BufferGeometry,s=50,a=new Float32Array(s*3);for(let c=0;c<s*3;c++)a[c]=(Math.random()-.5)*2;i.setAttribute("position",new n.BufferAttribute(a,3));const t=new n.PointsMaterial({size:.02,color:16767293,transparent:!0,opacity:.8,blending:n.AdditiveBlending}),e=new n.Points(i,t);e.position.set(0,.8,0),o.add(e);let r=0;const l=()=>{r+=.02,e.rotation.y=r;const c=e.geometry.attributes.position.array;for(let f=0;f<c.length;f+=3)c[f+1]+=Math.sin(r+f)*.001;e.geometry.attributes.position.needsUpdate=!0};renderer.setAnimationLoop(()=>{l()})}function E(o){const i=new n.BufferGeometry,s=[];for(let e=0;e<100;e++){const r=(Math.random()-.5)*3,l=(Math.random()-.5)*3,c=(Math.random()-.5)*.5;s.push(r,l,c)}i.setAttribute("position",new n.Float32BufferAttribute(s,3));const a=new n.PointsMaterial({color:5164484,size:.01,transparent:!0,opacity:.6}),t=new n.Points(i,a);o.add(t)}function g(){d&&u&&(d.stop(),d.renderer.setAnimationLoop(null),u=!1)}document.addEventListener("visibilitychange",()=>{document.hidden&&u&&g()});console.log("ğŸŠ AR Year-End Invitation Card initialized!");console.log("ğŸ“ Remember to:");console.log("   1. Generate targets.mind file using MindAR Image Compiler");console.log("   2. Add your target images to the project");console.log("   3. Update the event details in the AR content");
